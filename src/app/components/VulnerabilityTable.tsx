import React from 'react';
import {
  DataTable,
  LoadingIndicator,
  Text,
  Button,
  showToast,
} from '@dynatrace/strato-components-preview';
import { useVulnerabilities } from '../hooks/useVulnerabilities';
import { VulnerabilityRecord } from '../hooks/useVulnerabilities';

export const VulnerabilityTable = () => {
  const { data, isLoading, isError } = useVulnerabilities();

  const columns = [
    { accessor: 'timestamp', header: 'Timestamp', width: 160 },
    { accessor: 'cve', header: 'CVE', width: 120 },
    { accessor: 'processGroup', header: 'Process Group', width: 200 },
    { accessor: 'detail', header: 'Problem Detail', width: 300 },
    {
      header: 'Actions',
      cell: ({ row }: { row: { original: VulnerabilityRecord } }) => (
        <Button
          onClick={() =>
            showToast({
              title: 'Exception requested',
              message: `Requested exception for ${row.original.cve}`,
              type: 'info',
              lifespan: 3000,
            })
          }
        >
          Request exception
        </Button>
      ),
    },
  ];

  if (isLoading) {
    return <LoadingIndicator />;
  }

  if (isError) {
    return <Text>Error loading vulnerabilities</Text>;
  }

  return <DataTable columns={columns} data={data ?? []} resizable fullWidth />;
};
